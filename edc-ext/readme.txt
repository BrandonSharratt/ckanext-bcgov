########################################################################### EDC/CKAN v.0.9.0_0007## This document constitutes the delivery instructions for ## K.Mamakani, HighwayThreeSolutions, Sep. 16, 2014##########################################################################1) List of changes:CITZEDC-378: The api is to include only records with Record State of "Published" or "Pending Archive".
CITZEDC-392: Editing dataset resources doesn't do anything when there are multiple resources.

2) Installation Instructions:1.	Activate virtual env$ . /usr/lib/ckan/default/bin/activate2.	Clean and initialize database$ cd /usr/lib/ckan/default/src/ckan$ paster db clean -c /etc/ckan/default/development.ini$ paster db init -c /etc/ckan/default/development.ini3.	Setup postgis database(Jira ticket 190)•	swith to root user$ su•	Make sure that the following line in  is commented out:DROP TABLE spatial_ref_sys;$ su - postgres•	Uninstall postgis database objects :$ psql -d ckan_default -f /usr/pgsql-9.2/share/contrib/postgis-2.1/uninstall_postgis.sql•	install postgis database :$ psql -d ckan_default -f /usr/pgsql-9.2/share/contrib/postgis-2.1/postgis.sql$ psql -d ckan_default -f /usr/pgsql-9.2/share/contrib/postgis-2.1/spatial_ref_sys.sql•	Alter postgis tables :$ psql$ postgres=# \c ckan_default$ ckan_default=#  ALTER TABLE spatial_ref_sys OWNER TO ckan_default;$ ckan_default=#  ALTER TABLE geometry_columns OWNER TO ckan_default;$ ckan_default=#  \q•	Check if postgis database setup is done properly :$ psql -d ckan_default -c "SELECT postgis_full_version()"	4.	back to virtual environment$ exit$ exit 5.	Create sysadmin account(s)$ paster  sysadmin add <username> -c /etc/ckan/default/development.ini6.	Update config file (if there are any changes)
	Note: Add admin api key to the ini file as ckan.api_key 7.	 Fetch source code changes from SVN8.	Install plugins and restart apacheFor each extension cd to extension’s  root folder and run$ Python setup.py>> ============== STEPS 9-13 ARE FOR H3 - Notify them when you finish STEP 8  =============== <<9.	Add api key  and site_url to base.py (required for vocabs, orgs and data import)

10.	Add the major and minor version numbers to ini file as follow :
	edc.major_version = DLVR
	edc.minor_version = .0.9.0_SNAPSHOT8

11.     Update the default admin user email address to datacat@gov.bc.ca12.	Create  vocabscd ckanext-edc-schema/ckanext/edc_schema/commands$ python create_vocabs.py13.	Create orgs$ cd ckanext-edc-schema/ckanext/edc_schema/commands$ python create_orgs.pyNote : for the following two steps, you need vpn connection, and activate the virtual environment14.	 Import users$ cd ckanext-edc-schema/ckanext/edc_schema/commands$ python import_users.py15.	Import data•	Before importing data make sure :•	discovery_ODSI.json file exists, otherwise, run “python common_records.py” first to load the discovery records that are available in ODSI as well.•	“odsi_record_count.txt” and “discovery_record_count.txt” do not exist. These two files simply keep track of the number of records that have been imported.  So, if by some reason the data import stopped, we can resume the script without reimporting the previous records and creating duplicate records. •	The admin_user variable has a proper value in data_import.py $ cd ckanext-edc-schema/ckanext/edc_schema/commands$ python data_import.py>> ======= STEPS 9-13 ARE FOR H3 - H3 to notify Ministry when they have completed them  ========= <<16. Re-index SOLR17. Update ETS and EAS WebADE configuration with the new api_key and URL:

PREFERENCES:
auth-settings	edc.url
auth-settings	edc.admin.key18. Create sysadmin users using paster command for Greg Lawrence and Daniel Edler:paster --plugin=ckan sysadmin add <user_name > -c /path/to/ckan/config/file3) Special Instructionsa) adding the ckan.api_key:

	1) Log in as a sysadmin (doesn’t matter which, just need sysadmin privileges)
	2) Go to that user’s dashboard (click the logged-in username in the main navigation)
	3) Scroll down and find “API Key”.  Copy that key and use it as ckan.api_key  in .ini file
b) copy the token.dat file in apps.bcgov/svn/edc/config/delivery/trunk/ckan to /etc/ckan/dlv/token.dat (required for ga-report extension)c) install the db tables for ga-report extension. From the src/ckanext-ga-report directory run:    $ paster initdb --config=/path/to/ckan/config/filed) add the password for the google analytics account to dlv.ini: googleanalytics.password = 
e) copy the edc_sectors.json file in apps.bcgov/svn/edc/config/delivery/trunk/ckan to /etc/ckan/dlv/edc_sectors.jsone) add the url to sectors json file to dlv.ini after ckan.api_key : sectors_file_url = file:///etc/ckan/dlv/edc_sectors.json