########################################################################### EDC/CKAN v.0.9.0_0005## This document constitutes the delivery instructions for ## J.Hannis, HighwayThreeSolutions, Aug. 26, 2014##########################################################################1) List of changes:CITZEDC-276: UI changesCITZEDC-298: User interface changes (August 13th 2014)CITZEDC-322: My Organizations List -CITZEDC-285: Search conditionsCITZEDC-279: Creating an application record - Finish Button - results in Authorization ErrorCITZEDC-300: Data import of Resource Name for BCGW datasetsCITZEDC-315: Remove Delete button on entry page for states other than draftCITZEDC-312: View in iMap buttonCITZEDC-299: Remove Follow buttonCITZEDC-304: Resource URL field has gone missing from 2nd page of add dataset.CITZEDC-302: Archived Records are Visible to IDIR and Public - should only be visible to Editor and AdminCITZEDC-313: DISQUS Moderation in EDS TESTCITZEDC-259: DISQUS system behaviourCITZEDC-27: Add WebTrends code to EDC.CITZEDC-289: Editor cannot access dataset after creationCITZEDC-75: Maintain a materialized view of all catalogue content in Oracle.CITZEDC-294: Geographic Datset - Add value to ProjectionCITZEDC-297: Links in HeaderCITZEDC-317: Format missing for WebServicesCITZEDC-318: Remove Resource Update Cycle Select for the Webservice/API and Application TemplatesCITZEDC-7: JAVA EDC Authorization AppCITZEDC-140: Support for data.gov QA site link changesCITZEDC-293: Create Dataset-Editor is able to select Branch that they are not authorized forCITZEDC-249: License dropdown clean upCITZEDC-139: Configure datastore for both sandbox and Ministry envCITZEDC-248: Spelling mistakesCITZEDC-311: Schedule EDC Migration to EDS TEST Environment for Thursday-Aug 21CITZEDC-291: Resource Update Cycle - missing "Fortnightly" as selection in DropdownCITZEDC-296: Turn off GravatarCITZEDC-240: Cookie expiration time based and browser closedCITZEDC-290: Editor is unable to set record to Pending ArchiveCITZEDC-310:grant james access to http://cat.data.gov.bc.caCITZEDC-284: Search Box - Entry of Placeholder Text and background display of autocomplete textCITZEDC-287: "More Info"CITZEDC-286: "Select" as an optionCITZEDC-223: Update order by select list on dataset search pageCITZEDC-270: Organization Browse for Datasets Does Not WorkCITZEDC-301: googlebot is into your sandbox - please block with robots.txtCITZEDC-303: Remove 'Subscribe to Most liked comments'CITZEDC-280: URL FIELD MOVES WHEN NEW PACKAGE IS CREATEDCITZEDC-282: Sector Facet spelling error - ecnomy not economyCITZEDC-198: Remove or change "About" page text.CITZEDC-261: Move Object NameCITZEDC-272: Create database request to create PROXY_ETS and the GEOMETADATA_SUMMARY tableCITZEDC-329: EAS fails login with an error 500 in delivery env2) Installation Instructions:1.	Activate virtual env$ . /usr/lib/ckan/default/bin/activate2.	Clean and initialize database$ cd /usr/lib/ckan/default/src/ckan$ paster db clean -c /etc/ckan/default/development.ini$ paster db init -c /etc/ckan/default/development.ini3.	Setup postgis database(Jira ticket 190)•	swith to root user$ su•	Make sure that the following line in  is commented out:DROP TABLE spatial_ref_sys;$ su - postgres•	Uninstall postgis database objects :$ psql -d ckan_default -f /usr/pgsql-9.2/share/contrib/postgis-2.1/uninstall_postgis.sql•	install postgis database :$ psql -d ckan_default -f /usr/pgsql-9.2/share/contrib/postgis-2.1/postgis.sql$ psql -d ckan_default -f /usr/pgsql-9.2/share/contrib/postgis-2.1/spatial_ref_sys.sql•	Alter postgis tables :$ psql$ postgres=# \c ckan_default$ ckan_default=#  ALTER TABLE spatial_ref_sys OWNER TO ckan_default;$ ckan_default=#  ALTER TABLE geometry_columns OWNER TO ckan_default;$ ckan_default=#  \q•	Check if postgis database setup is done properly :$ psql -d ckan_default -c "SELECT postgis_full_version()"	4.	back to virtual environment$ exit$ exit 5.	Create sysadmin account(s)$ paster  sysadmin add <username> -c /etc/ckan/default/development.ini6.	Update config file (if there are any changes)7.	 Fetch source code changes from SVN8.	Install plugins and restart apacheFor each extension cd to extension’s  root folder and run$ Python setup.py>> ============== STEPS 9-13 ARE FOR H3 - Notify them when you finish STEP 8  =============== <<9.	Add api key  and site_url to base.py (required for vocabs, orgs and data import)10.	Create  vocabscd ckanext-edc-schema/ckanext/edc_schema/commands$ python create_vocabs.py11.	Create orgs$ cd ckanext-edc-schema/ckanext/edc_schema/commands$ python create_orgs.pyNote : for the following two steps, you need vpn connection, and activate the virtual environment12.	 Import users$ cd ckanext-edc-schema/ckanext/edc_schema/commands$ python import_users.py13.	Import data•	Before importing data make sure :•	discovery_ODSI.json file exists, otherwise, run “python common_records.py” first to load the discovery records that are available in ODSI as well.•	“odsi_record_count.txt” and “discovery_record_count.txt” do not exist. These two files simply keep track of the number of records that have been imported.  So, if by some reason the data import stopped, we can resume the script without reimporting the previous records and creating duplicate records. •	The admin_user variable has a proper value in data_import.py $ cd ckanext-edc-schema/ckanext/edc_schema/commands$ python data_import.py>> ======= STEPS 9-13 ARE FOR H3 - H3 to notify Ministry when they have completed them  ========= <<14. Update ETS and EAS WebADE configuration with the new api_key and URL:

PREFERENCES:
auth-settings	edc.url
auth-settings	edc.admin.key15. Create sysadmin users using paster command for Greg Lawrence and Daniel Edler:paster --plugin=ckan sysadmin add <user_name > -c /path/to/ckan/config/file16. Add the configure the logout URL setting to the .ini file. This is what it looks like in our environment:#page to return to after logout via siteminderedc.siteminder_return_url=http://edc.highwaythreesolutions.com/user/logged_out_redirect3) Special Instructionsa) ETS application (assumes the latest code has already been checked out of SVN):i) cd to the source directory:cd …/ets/ii) build the app.:mvn -f pom.xml clean installiii) create a run directory:mkdir /usr/share/ckan/etsiv) copy over the necessary filescp …/ets/run.sh /usr/share/ckan/etscp …/ets/src/main/resources/*.properties /usr/share/ckan/etscp …/ets/target/ets-jar-with-dependencies.jar /usr/share/ckan/etsv) set the WebADE PREFERENCE and PROXY_CONTROL entries correctlyb) Configure the DISQUS commenting system:So to get comments up and running on their delivery environment, you will have to add these lines to the config (.ini) file for CKAN:Remove "disqus" from the ckan.plugins and add "edcdisqus"edcdisqus.api_key = <associated with account/application>edcdisqus.forum_name = <associated with account/application>edcdisqus.access_token = <associated with account/application>edcdisqus.widget_api_key = E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2FPlease contact Greg Lawrance or Daniel Edler for the values for the first 3 items.