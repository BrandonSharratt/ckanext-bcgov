{% ckan_extends %}

{% set rec_stat = data.get('resource_status', []) %}

{% block package_basic_fields_title %}
	{% resource 'edc_resource/edc_dataset.js' %}
	<div class="form-horizontal">
  	{{ form.input('title', id='field-title', label=_('Title'), placeholder=_('eg. A descriptive title'), value=data.title, error=errors.title, classes=['control-full', 'control-large'], attrs={'data-module': 'slug-preview-target'}) }}
	</div>
{% endblock %}

{% block package_basic_fields_url %}
  	{% set prefix = h.url_for(controller='package', action='read', id='') %}
  	{% set domain = h.url_for(controller='package', action='read', id='', qualified=true) %}
  	{% set domain = domain|replace("http://", "")|replace("https://", "") %}
  	{% set attrs = {'data-module': 'slug-preview-slug', 'data-module-prefix': domain, 'data-module-placeholder': '<dataset>'} %}
  	<div class="form-horizontal">
  	{{ form.prepend('name', id='field-name', label=_('URL'), prepend=prefix, placeholder=_('eg. my-dataset'), value=data.name, error=errors.name, attrs=attrs, classes=['control-full'], is_required=true) }}
  	</div>
{% endblock %}


{% block package_basic_fields_description %}

    <div class="control-list form-horizontal">
    	<div class="control-group">
        	<label class="control-label">{{ _("Record Type") }}</label>
        	<div class="controls control-info">
        		{{ h.record_type_label(record_type) }}
        	</div>
    	</div>

        <div class='required'>
            {{ form.markdown('notes', id='field-notes', label=_('Description'), placeholder=_('eg. Some
            useful notes about the data'), value=data.notes, error=errors.notes) }}
            {% if record_type != 'Application' and record_type != 'WebService' %}
            {{ form.markdown('purpose', label=_('Purpose'), placeholder=_('Summary of the intentions for which the dataset was developed.'), value=data.purpose, error=errors.purpose, classes=['purpose']) }}
            {% endif %}
            {# set tag_attrs = {'data-module': 'autocomplete', 'data-module-tags': '', 'data-module-source': '/api/3/util/tag/autocomplete?incomplete=?'} #}
            {% set tag_attrs = {'data-module': 'autocomplete', 'data-module-tags': 'http://localhost:5000/api/3/action/tag_list', 'data-module-source': 'http://localhost:5000/api/3/action/tag_list'} %}
            {# form.input('tag_string', id='field-tags', label=_('Keywords'), placeholder=_('eg. economy, mental health, government'), value=data.tag_string, error=errors.tags, classes=['control-full'], attrs=tag_attrs) #}
         
    	{% block edc_package_keywords %}
    		{% snippet 'package/snippets/edc_keywords.html', data=data, user=userobj, errors=errors %}
    	{% endblock %}

        </div>
    	{% block edc_package_org %}
    		{% snippet 'package/snippets/edc_orgs.html', data=data, user=userobj, errors=errors %}
    	{% endblock %}

        {% block package_contact_fields %}
            <h3 class="module-sub-heading">Contacts</h3>
            {% snippet 'package/snippets/contact_fields.html', contacts=data.contacts, errors=errors %}
        {% endblock %}
    </div>

    {% block hidden_fields %}
    	<input type="hidden" id="field-owner_org" name="owner_org" value="" />
    	{% set author = data.author or userobj.id %}
    	<input type="hidden" id="field-author" name="author" value = "{{ author }}" />
    {% endblock %}

<h3 class="module-sub-heading">Data Currency/Update</h3>
<div class="control-list">
	{% block package_dates_fields %}
    {% block resource_status_fields %}
        {% snippet 'package/snippets/resource_status_fields.html', data=data, errors=errors %}
    {% endblock %}

		{% snippet 'package/snippets/date_fields.html', dates=data.dates, errors=errors %}
	{% endblock %}
</div>
	{% block package_security_classification %}
		{% set security_class_error = errors.security_class %}
		{% set bc_ocio_error = errors.bc_ocio %}
	<h3 class="module-sub-heading">Access & Security</h3>
	<div class="control-list">
        <div class="row-fluid">
            <div class="span6">
        		<div class="required control-group control-medium{{ " error" if security_class_error }}">
            		<label class="control-label" for="field-security_class"><span class="control-required">*</span> {{ _("Security Classification") }}</label>
            		<div class="controls">
            			{% set security_class_list = h.edc_tags(_("security_class")) %}
            			{% set current_security_class = data.security_class %}
                		<select id="field-security_class" name="security_class" data-module="autocomplete" class="required">
                			<option value ='' {% if not selected_class %} selected="selected" {% endif %}>Select a security classification</option>
              				{% for tag in security_class_list  %}
              				{% set selected_class = (current_security_class and current_security_class == tag.id) %}
              					<option value="{{ tag.id }}"
              						{% if selected_class %} selected="selected" {% endif %}>
              						{{ tag.name }}
              					</option>
              				{% endfor %}
                		</select>
                        {% if security_class_error and security_class_error is iterable %}
                            <span class="error-block">{{ security_class_error|join(', ') }}</span>
                        {% endif %}
            		</div>
            	</div>
            </div>
        </div>

        {% block package_access_contraints %}
            <div class="control-group">
                {% set view_error = errors.view_audience %}
                {% set download_error = errors.download_audience %}
                <div  class="required control-group control-medium{{ " error" if view_error }}">
                    <label class="control-label" for="field-view_audience"><span class="control-required">*</span> Who can view this data?</label>
                    {% set view_audience_list = h.edc_tags(_("viewable")) %}
                    {% set current_audience = data.view_audience %}
                    <div class="controls">
                        <select id="field-view_audience" name="view_audience" data-module="autocomplete" class="required">
                            <option value = '' {% if not selected_audience %} selected="selected" {% endif %}>Select a view audience</option>
                            {% for tag in view_audience_list %}
                                {% set selected_audience = (current_audience and current_audience == tag.id) %}
                                <option value="{{ tag.id }}"
                                    {% if selected_audience %} selected="selected" {% endif %}>
                                    {{ tag.name }}
                                </option>
                            {% endfor %}
                        </select>
                        {% if view_error and view_error is iterable %}
                            <span class="error-block">{{ view_error|join(', ') }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="control-group">
                <div class="required control-group control-medium{{ " error" if download_error }}">
                    <label class="control-label" for="field-download_audience"><span class="control-required">*</span> Who can download this data?</label>
                    {% set download_audience_list = h.edc_tags(_("downloadable")) %}
                    {% set current_audience = data.download_audience %}
                    <div class="controls">
                        <select id="field-download_audience" name="download_audience" data-module="autocomplete" class="required">
                            <option value ='' {% if not selected_audience %} selected="selected" {% endif %}>Select a download audience</option>
                            {% for tag in download_audience_list  %}
                                {% set selected_audience = (current_audience and current_audience == tag.id) %}
                                <option value="{{ tag.id }}"
                                    {% if selected_audience %} selected="selected" {% endif %}>
                                    {{ tag.name }}
                                </option>
                            {% endfor %}
                        </select>
                        {% if download_error and download_error is iterable %}
                            <span class="error-block">{{ download_error|join(', ') }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endblock %}

        {% block metadata_constraints %}
        {% block metadata_visibility %}
            {% set metadata_visibility_error = errors.metadata_visibility %}
            <div class="required control-group control-medium{{ " error" if metadata_visibility_error }}">
                <label class="control-label" for="field-metadata_visibility"><span class="control-required">*</span> {{ _("Who can view this record?") }}</label>
                <div class="controls">
                {% set metadata_visibility_list = h.edc_tags(_("metadata_visibility"))  %}
                {% set current_visibility = data.metadata_visibility %}
                <select id="field-metadata_visibility" name="metadata_visibility" data-module="autocomplete">
                    <option value ='' {% if not selected_visibility %} selected="selected" {% endif %}>Select metadata visibility</option>
                    {% for tag in metadata_visibility_list  %}
                        {% set selected_visibility = (current_visibility and current_visibility == tag.id) %}
                        <option value="{{ tag.id }}"
                            {% if selected_visibility %} selected="selected" {% endif %}>
                            {{ tag.name }}
                        </option>
                    {% endfor %}
                </select>
                {% if metadata_visibility_error and metadata_visibility_error is iterable %}
                    <span class="error-block">{{ metadata_visibility_error|join(', ') }}</span>
                {% endif %}
                </div>
            </div>
        {% endblock %}

        {% set error = errors.license_id %}
        <div class="control-group{{ " error" if error }}">
          <label class="control-label" for="field-license"><span class="control-required">*</span> {{ _("License") }}</label>
          <div class="controls">
            <select id="field-license" name="license_id" data-module="autocomplete">
              {% for license_desc, license_id in licenses|sort if license_desc  %}
                <option value="{{ license_id }}" {% if data.get('license_id', '0') == license_id %}selected="selected"{% endif %}>{{ license_desc }}</option>
              {% endfor %}
            </select>
            {% if error %}<span class="error-block">{{ error|join(', ') }}</span>{% endif %}
          </div>
        </div>

        {% block package_privacy %}
            {% set pa_error = errors.privacy_impact_assessment %}
            <div class="required control-group{{ " error" if pa_error }}">
                <label class="control-label"><span class="control-required">*</span> Has a privacy impact assessment been completed on this data?</label>
                <div clss="controls">
                    <div class="radio-inline">
                        <label>
                            <input type="radio" name="privacy_impact_assessment" value="Y"
                                {% if data['privacy_impact_assessment'] == 'Y' %} checked="checked" {% endif %} >Yes
                        </label>
                    </div>
                    <div class="radio-inline">
                        <label>
                            <input type="radio" name="privacy_impact_assessment" value="N"
                                {% if data['privacy_impact_assessment'] == 'N' %} checked="checked" {% endif %}>No
                        </label>
                    </div>
                </div>
                {% if pa_error and pa_error is iterable %}<span class="error-block">{{ pa_error|join(', ') }}</span>{% endif %}
            </div>
        {% endblock %}

    {% endblock %}
	</div>
	{% endblock %}

	{% block package_topic %}
		{% set topic_error = errors.iso_topic_cat %}
		<h3 class="module-sub-heading"> Topic </h3>
		<div class="required control-list control-group control-medium form-horizontal">
            <div class="control-group {{ " error" if topic_error }}">
                <label class="control-label" for="field-iso_topic_cat"><span class="control-required">*</span> {{ _("ISO Topic Category") }}</label>
    			{% set topic_cat_list = h.edc_tags(_("iso_topic_category")) %}
    			{% set current_cat = data.iso_topic_cat %}
    			<div class="controls">
        			<select id="field-iso_topic_cat" name="iso_topic_cat" data-module="autocomplete" class="required">
        				<option value ='' {% if not selected_cat %} selected="selected" {% endif %}>Select a category</option>
      					{% for tag in topic_cat_list  %}
      						{% set selected_cat = (current_cat and current_cat == tag.id) %}
      						<option value="{{ tag.id }}"
      							{% if selected_cat %} selected="selected" {% endif %}>
      							{{ tag.name }}
      						</option>
      					{% endfor %}
        			</select>
        			{% if topic_error and topic_error is iterable %}
        				<span class="error-block">{{ topic_error|join(', ') }}</span>
        			{% endif %}
        		</div>
            </div>
            {% block online_reference %}
            	{#
                {% set level_error = errors.metadata_hierarchy_level %}
                <div class="control-group">
                <div class="control-group control-medium{{ " error" if level_error }}">
                    <label class="control-label" for="field-metadata_hierarchy_level">{{ _("Metadata Hierarchy Level") }}</label>
                    <div class="controls">
                        {% set hierarchy_level_list = h.edc_tags(_("metadata_hierarchy_level")) %}
                        {% set current_level = data.metadata_hierarchy_level %}
                        <select id="field-metadata_hierarchy_level" name="metadata_hierarchy_level" data-module="autocomplete" class="required">
                            <option value ='' {% if not selected_level %} selected="selected" {% endif %}>Select a hierarchy level</option>
                                {% for tag in hierarchy_level_list  %}
                                    {% set selected_level = (current_level and current_level == tag.id) %}
                                    <option value="{{ tag.id }}"
                                        {% if selected_level %} selected="selected" {% endif %}>
                                        {{ tag.name }}
                                    </option>
                                {% endfor %}
                        </select>
                        {% if level_error and level_error is iterable %}
                            <span class="error-block">{{ level_error|join(', ') }}</span>
                        {% endif %}
                    </div>
                </div>


                    {{ form.input('url', label="<span class='control-required'>*</span> "|safe + _('Resource Link'), id='field-url',
                                         placeholder=_('http://example.com/dataset.json'),
                                         value=data.url,
                                         error=errors.url,
                                         classes=['control-full'])
                    }}
                </div> #}
            {% snippet 'package/snippets/more_info.html', info_list=data.more_info, errors=errors %}
        {% endblock %}

		</div>
	{% endblock %}

	{% block data_quality_info %}
	{% if record_type == _('Geographic') %}
		<div id="object_name_container" class="control-full">
    		{{ form.input('object_name',
    						label=_("Object Name"),
    						id='field-object_name',
    						placeholder=_(''),
    						value=data.object_name,
    						error=errors.object_name,
    						classes=['control-full']) }}

		</div>
	{% endif %}
	{% endblock %}

{% endblock %}

{% block package_basic_fields_license %}
{% endblock %}

{% block package_basic_fields_custom %}

	{{ super() }}

{% endblock %}

{% block package_basic_fields_tags %}
{% endblock %}

{% block package_metadata_fields_visibility %}
{% endblock %}

{% block package_basic_fields_org %}
{% endblock %}